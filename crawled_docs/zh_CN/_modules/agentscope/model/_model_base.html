<!-- Title: agentscope.model._model_base - AgentScope -->
<!-- URL: https://doc.agentscope.io/zh_CN/_modules/agentscope/model/_model_base.html -->

          <h1>agentscope.model._model_base 源代码</h1><div class="highlight"><pre><span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">"""The chat model base class."""</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">abc</span><span class="w"> </span><span class="kn">import</span> <span class="n">abstractmethod</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">AsyncGenerator</span><span class="p">,</span> <span class="n">Any</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">._model_response</span><span class="w"> </span><span class="kn">import</span> <span class="n">ChatResponse</span>

<span class="n">TOOL_CHOICE_MODES</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"auto"</span><span class="p">,</span> <span class="s2">"none"</span><span class="p">,</span> <span class="s2">"any"</span><span class="p">,</span> <span class="s2">"required"</span><span class="p">]</span>


<div class="viewcode-block" id="ChatModelBase">
<a class="viewcode-back" href="../../../api/agentscope.model.html#agentscope.model.ChatModelBase">[文档]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">ChatModelBase</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Base class for chat models."""</span>

    <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span>
<span class="w">    </span><span class="sd">"""The model name"""</span>

    <span class="n">stream</span><span class="p">:</span> <span class="nb">bool</span>
<span class="w">    </span><span class="sd">"""Is the model output streaming or not"""</span>

<div class="viewcode-block" id="ChatModelBase.__init__">
<a class="viewcode-back" href="../../../api/agentscope.model.html#agentscope.model.ChatModelBase.__init__">[文档]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">stream</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Initialize the chat model base class.</span>

<span class="sd">        Args:</span>
<span class="sd">            model_name (`str`):</span>
<span class="sd">                The name of the model</span>
<span class="sd">            stream (`bool`):</span>
<span class="sd">                Whether the model output is streaming or not</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_name</span> <span class="o">=</span> <span class="n">model_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stream</span> <span class="o">=</span> <span class="n">stream</span></div>


<div class="viewcode-block" id="ChatModelBase.__call__">
<a class="viewcode-back" href="../../../api/agentscope.model.html#agentscope.model.ChatModelBase.__call__">[文档]</a>
    <span class="nd">@abstractmethod</span>
    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ChatResponse</span> <span class="o">|</span> <span class="n">AsyncGenerator</span><span class="p">[</span><span class="n">ChatResponse</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
        <span class="k">pass</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_validate_tool_choice</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">tool_choice</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">tools</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Validate tool_choice parameter.</span>

<span class="sd">        Args:</span>
<span class="sd">            tool_choice (`str`):</span>
<span class="sd">                Tool choice mode or function name</span>
<span class="sd">            tools (`list[dict] | None`):</span>
<span class="sd">                Available tools list</span>
<span class="sd">        Raises:</span>
<span class="sd">            TypeError: If tool_choice is not string</span>
<span class="sd">            ValueError: If tool_choice is invalid</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tool_choice</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">"tool_choice must be str, got </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">tool_choice</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">tool_choice</span> <span class="ow">in</span> <span class="n">TOOL_CHOICE_MODES</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">available_functions</span> <span class="o">=</span> <span class="p">[</span><span class="n">tool</span><span class="p">[</span><span class="s2">"function"</span><span class="p">][</span><span class="s2">"name"</span><span class="p">]</span> <span class="k">for</span> <span class="n">tool</span> <span class="ow">in</span> <span class="n">tools</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">tool_choice</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">available_functions</span><span class="p">:</span>
            <span class="n">all_options</span> <span class="o">=</span> <span class="n">TOOL_CHOICE_MODES</span> <span class="o">+</span> <span class="n">available_functions</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">"Invalid tool_choice '</span><span class="si">{</span><span class="n">tool_choice</span><span class="si">}</span><span class="s2">'. "</span>
                <span class="sa">f</span><span class="s2">"Available options: </span><span class="si">{</span><span class="s1">', '</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">all_options</span><span class="p">))</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span>
            <span class="p">)</span></div>

</pre></div>
        