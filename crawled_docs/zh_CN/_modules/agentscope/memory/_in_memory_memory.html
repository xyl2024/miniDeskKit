<!-- Title: agentscope.memory._in_memory_memory - AgentScope -->
<!-- URL: https://doc.agentscope.io/zh_CN/_modules/agentscope/memory/_in_memory_memory.html -->

          <h1>agentscope.memory._in_memory_memory 源代码</h1><div class="highlight"><pre><span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">"""The dialogue memory class"""</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Union</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">,</span> <span class="n">Any</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">._memory_base</span><span class="w"> </span><span class="kn">import</span> <span class="n">MemoryBase</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">..message</span><span class="w"> </span><span class="kn">import</span> <span class="n">Msg</span>


<div class="viewcode-block" id="InMemoryMemory">
<a class="viewcode-back" href="../../../api/agentscope.memory.html#agentscope.memory.InMemoryMemory">[文档]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">InMemoryMemory</span><span class="p">(</span><span class="n">MemoryBase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""The in-memory memory class for storing messages."""</span>

<div class="viewcode-block" id="InMemoryMemory.__init__">
<a class="viewcode-back" href="../../../api/agentscope.memory.html#agentscope.memory.InMemoryMemory.__init__">[文档]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Initialize the in-memory memory object."""</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Msg</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span></div>


<div class="viewcode-block" id="InMemoryMemory.state_dict">
<a class="viewcode-back" href="../../../api/agentscope.memory.html#agentscope.memory.InMemoryMemory.state_dict">[文档]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">state_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Convert the current memory into JSON data format."""</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">"content"</span><span class="p">:</span> <span class="p">[</span><span class="n">_</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">],</span>
        <span class="p">}</span></div>


<div class="viewcode-block" id="InMemoryMemory.load_state_dict">
<a class="viewcode-back" href="../../../api/agentscope.memory.html#agentscope.memory.InMemoryMemory.load_state_dict">[文档]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">load_state_dict</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">state_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
        <span class="n">strict</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Load the memory from JSON data.</span>

<span class="sd">        Args:</span>
<span class="sd">            state_dict (`dict`):</span>
<span class="sd">                The state dictionary to load, which should have a "content"</span>
<span class="sd">                field.</span>
<span class="sd">            strict (`bool`, defaults to `True`):</span>
<span class="sd">                If `True`, raises an error if any key in the module is not</span>
<span class="sd">                found in the state_dict. If `False`, skips missing keys.</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">content</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">state_dict</span><span class="p">[</span><span class="s2">"content"</span><span class="p">]:</span>
            <span class="n">data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">"type"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Msg</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">data</span><span class="p">))</span></div>


<div class="viewcode-block" id="InMemoryMemory.size">
<a class="viewcode-back" href="../../../api/agentscope.memory.html#agentscope.memory.InMemoryMemory.size">[文档]</a>
    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">size</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""The size of the memory."""</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">)</span></div>


<div class="viewcode-block" id="InMemoryMemory.retrieve">
<a class="viewcode-back" href="../../../api/agentscope.memory.html#agentscope.memory.InMemoryMemory.retrieve">[文档]</a>
    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">retrieve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Retrieve items from the memory."""</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
            <span class="s2">"The retrieve method is not implemented in "</span>
            <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> class."</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="InMemoryMemory.delete">
<a class="viewcode-back" href="../../../api/agentscope.memory.html#agentscope.memory.InMemoryMemory.delete">[文档]</a>
    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Iterable</span><span class="p">,</span> <span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Delete the specified item by index(es).</span>

<span class="sd">        Args:</span>
<span class="sd">            index (`Union[Iterable, int]`):</span>
<span class="sd">                The index to delete.</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">index</span> <span class="o">=</span> <span class="p">[</span><span class="n">index</span><span class="p">]</span>

        <span class="n">invalid_index</span> <span class="o">=</span> <span class="p">[</span><span class="n">_</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">index</span> <span class="k">if</span> <span class="mi">0</span> <span class="o">&gt;</span> <span class="n">_</span> <span class="ow">or</span> <span class="n">_</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">)]</span>

        <span class="k">if</span> <span class="n">invalid_index</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">"The index </span><span class="si">{</span><span class="n">invalid_index</span><span class="si">}</span><span class="s2"> does not exist."</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">content</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">_</span> <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">)</span> <span class="k">if</span> <span class="n">idx</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">index</span>
        <span class="p">]</span></div>


<div class="viewcode-block" id="InMemoryMemory.add">
<a class="viewcode-back" href="../../../api/agentscope.memory.html#agentscope.memory.InMemoryMemory.add">[文档]</a>
    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">memories</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="n">Msg</span><span class="p">],</span> <span class="n">Msg</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
        <span class="n">allow_duplicates</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Add message into the memory.</span>

<span class="sd">        Args:</span>
<span class="sd">            memories (`Union[list[Msg], Msg, None]`):</span>
<span class="sd">                The message to add.</span>
<span class="sd">            allow_duplicates (`bool`, defaults to `False`):</span>
<span class="sd">                If allow adding duplicate messages (with the same id) into</span>
<span class="sd">                the memory.</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="n">memories</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">memories</span><span class="p">,</span> <span class="n">Msg</span><span class="p">):</span>
            <span class="n">memories</span> <span class="o">=</span> <span class="p">[</span><span class="n">memories</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">memories</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">"The memories should be a list of Msg or a single Msg, "</span>
                <span class="sa">f</span><span class="s2">"but got </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">memories</span><span class="p">)</span><span class="si">}</span><span class="s2">."</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">for</span> <span class="n">msg</span> <span class="ow">in</span> <span class="n">memories</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">Msg</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">"The memories should be a list of Msg or a single Msg, "</span>
                    <span class="sa">f</span><span class="s2">"but got </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span><span class="si">}</span><span class="s2">."</span><span class="p">,</span>
                <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">allow_duplicates</span><span class="p">:</span>
            <span class="n">existing_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">_</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">]</span>
            <span class="n">memories</span> <span class="o">=</span> <span class="p">[</span><span class="n">_</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">memories</span> <span class="k">if</span> <span class="n">_</span><span class="o">.</span><span class="n">id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">existing_ids</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">memories</span><span class="p">)</span></div>


<div class="viewcode-block" id="InMemoryMemory.get_memory">
<a class="viewcode-back" href="../../../api/agentscope.memory.html#agentscope.memory.InMemoryMemory.get_memory">[文档]</a>
    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_memory</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Msg</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">"""Get the memory content."""</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span></div>


<div class="viewcode-block" id="InMemoryMemory.clear">
<a class="viewcode-back" href="../../../api/agentscope.memory.html#agentscope.memory.InMemoryMemory.clear">[文档]</a>
    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Clear the memory content."""</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">content</span> <span class="o">=</span> <span class="p">[]</span></div>
</div>

</pre></div>
        