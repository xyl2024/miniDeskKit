<!-- Title: Handoffs - AgentScope -->
<!-- URL: https://doc.agentscope.io/zh_CN/tutorial/workflow_handoffs.html -->

          <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">备注</p>
<p><a class="reference internal" href="#sphx-glr-download-tutorial-workflow-handoffs-py"><span class="std std-ref">Go to the end</span></a>
to download the full example code.</p>
</div>
<section class="sphx-glr-example-title" id="handoffs">
<span id="sphx-glr-tutorial-workflow-handoffs-py"></span><span id="id1"></span><h1>Handoffs<a class="headerlink" href="#handoffs" title="Link to this heading">¶</a></h1>
<p>Handoffs 是由 OpenAI 提出的工作流模式，通过调用子智能体的方式来完成目标任务。
在 AgentScope 中通过工具调用的方式实现 handoffs 非常简单。首先，我们创建一个函数来允许协调者动态创建子智能体。</p>
<figure class="align-center" id="id2">
<a class="reference internal image-reference" href="../_images/handoffs.png"><img alt="协调者-子智能体工作流" src="../_images/handoffs.png" style="width: 80%;">
</a>
<figcaption>
<p><span class="caption-text"><em>Handoffs 示例</em></span><a class="headerlink" href="#id2" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Orchestrator: {
    "type": "tool_use",
    "name": "create_worker",
    "input": {
        "task_description": "在 Python 中编写并执行一个简单的 'Hello, World!' 程序。"
    },
    "id": "call_e4d8f4dfd71a4226bb697d"
}
Worker: {
    "type": "tool_use",
    "name": "execute_python_code",
    "input": {
        "code": "print('Hello, World!')",
        "timeout": 5
    },
    "id": "call_803ba2eaf90b46e897b054"
}
system: {
    "type": "tool_result",
    "id": "call_803ba2eaf90b46e897b054",
    "name": "execute_python_code",
    "output": [
        {
            "type": "text",
            "text": "&lt;returncode&gt;0&lt;/returncode&gt;&lt;stdout&gt;Hello, World!\n&lt;/stdout&gt;&lt;stderr&gt;&lt;/stderr&gt;"
        }
    ]
}
Worker: 成功执行了 Python 代码，输出为：

```
Hello, World!
```
system: {
    "type": "tool_result",
    "id": "call_e4d8f4dfd71a4226bb697d",
    "name": "create_worker",
    "output": [
        {
            "type": "text",
            "text": "成功执行了 Python 代码，输出为：\n\n```\nHello, World!\n```"
        }
    ]
}
Orchestrator: 子智能体成功在 Python 中执行了 'Hello, World!' 程序，输出为：

```
Hello, World!
```
</pre></div>
</div>
<div class="line-block">
<div class="line"><br></div>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">agentscope.agent</span><span class="w"> </span><span class="kn">import</span> <span class="n">ReActAgent</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">agentscope.formatter</span><span class="w"> </span><span class="kn">import</span> <span class="n">DashScopeChatFormatter</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">agentscope.memory</span><span class="w"> </span><span class="kn">import</span> <span class="n">InMemoryMemory</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">agentscope.message</span><span class="w"> </span><span class="kn">import</span> <span class="n">Msg</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">agentscope.model</span><span class="w"> </span><span class="kn">import</span> <span class="n">DashScopeChatModel</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">agentscope.tool</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">ToolResponse</span><span class="p">,</span>
    <span class="n">Toolkit</span><span class="p">,</span>
    <span class="n">execute_python_code</span><span class="p">,</span>
<span class="p">)</span>


<span class="c1"># 创建子智能体的工具函数</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">create_worker</span><span class="p">(</span>
    <span class="n">task_description</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ToolResponse</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""创建一个子智能体来完成给定的任务。子智能体配备了 Python 执行工具。</span>

<span class="sd">    Args:</span>
<span class="sd">        task_description (``str``):</span>
<span class="sd">            子智能体要完成的任务描述。</span>
<span class="sd">    """</span>
    <span class="c1"># 为子智能体智能体配备一些工具</span>
    <span class="n">toolkit</span> <span class="o">=</span> <span class="n">Toolkit</span><span class="p">()</span>
    <span class="n">toolkit</span><span class="o">.</span><span class="n">register_tool_function</span><span class="p">(</span><span class="n">execute_python_code</span><span class="p">)</span>

    <span class="c1"># 创建子智能体智能体</span>
    <span class="n">worker</span> <span class="o">=</span> <span class="n">ReActAgent</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">"Worker"</span><span class="p">,</span>
        <span class="n">sys_prompt</span><span class="o">=</span><span class="s2">"你是一个智能体。你的目标是完成给定的任务。"</span><span class="p">,</span>
        <span class="n">model</span><span class="o">=</span><span class="n">DashScopeChatModel</span><span class="p">(</span>
            <span class="n">model_name</span><span class="o">=</span><span class="s2">"qwen-max"</span><span class="p">,</span>
            <span class="n">api_key</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">"DASHSCOPE_API_KEY"</span><span class="p">],</span>
            <span class="n">stream</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">formatter</span><span class="o">=</span><span class="n">DashScopeChatFormatter</span><span class="p">(),</span>
        <span class="n">toolkit</span><span class="o">=</span><span class="n">toolkit</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="c1"># 让子智能体完成任务</span>
    <span class="n">res</span> <span class="o">=</span> <span class="k">await</span> <span class="n">worker</span><span class="p">(</span><span class="n">Msg</span><span class="p">(</span><span class="s2">"user"</span><span class="p">,</span> <span class="n">task_description</span><span class="p">,</span> <span class="s2">"user"</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">ToolResponse</span><span class="p">(</span>
        <span class="n">content</span><span class="o">=</span><span class="n">res</span><span class="o">.</span><span class="n">get_content_blocks</span><span class="p">(</span><span class="s2">"text"</span><span class="p">),</span>
    <span class="p">)</span>


<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">run_handoffs</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""交接工作流示例。"""</span>
    <span class="c1"># 初始化协调者智能体</span>
    <span class="n">toolkit</span> <span class="o">=</span> <span class="n">Toolkit</span><span class="p">()</span>
    <span class="n">toolkit</span><span class="o">.</span><span class="n">register_tool_function</span><span class="p">(</span><span class="n">create_worker</span><span class="p">)</span>

    <span class="n">orchestrator</span> <span class="o">=</span> <span class="n">ReActAgent</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">"Orchestrator"</span><span class="p">,</span>
        <span class="n">sys_prompt</span><span class="o">=</span><span class="s2">"你是一个协调者智能体。你的目标是通过将任务分解为更小的任务并创建子智能体来完成它们，从而完成给定的任务。"</span><span class="p">,</span>
        <span class="n">model</span><span class="o">=</span><span class="n">DashScopeChatModel</span><span class="p">(</span>
            <span class="n">model_name</span><span class="o">=</span><span class="s2">"qwen-max"</span><span class="p">,</span>
            <span class="n">api_key</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">"DASHSCOPE_API_KEY"</span><span class="p">],</span>
            <span class="n">stream</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">memory</span><span class="o">=</span><span class="n">InMemoryMemory</span><span class="p">(),</span>
        <span class="n">formatter</span><span class="o">=</span><span class="n">DashScopeChatFormatter</span><span class="p">(),</span>
        <span class="n">toolkit</span><span class="o">=</span><span class="n">toolkit</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># 任务描述</span>
    <span class="n">task_description</span> <span class="o">=</span> <span class="s2">"在 Python 中执行 hello world"</span>

    <span class="c1"># 创建子智能体来完成任务</span>
    <span class="k">await</span> <span class="n">orchestrator</span><span class="p">(</span><span class="n">Msg</span><span class="p">(</span><span class="s2">"user"</span><span class="p">,</span> <span class="n">task_description</span><span class="p">,</span> <span class="s2">"user"</span><span class="p">))</span>


<span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">run_handoffs</span><span class="p">())</span>
</pre></div>
</div>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> (0 minutes 8.256 seconds)</p>
<div class="sphx-glr-footer sphx-glr-footer-example docutils container" id="sphx-glr-download-tutorial-workflow-handoffs-py">
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../_downloads/91c90a0c5fa0aaee5502046f62e97d67/workflow_handoffs.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">workflow_handoffs.ipynb</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../_downloads/40c5b824c1cbfdf31e5d9d0ae9140188/workflow_handoffs.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">workflow_handoffs.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-zip docutils container">
<p><a class="reference download internal" download="" href="../_downloads/6d89fc9f89bb514a5e82581b402bb9ba/workflow_handoffs.zip"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">zipped:</span> <span class="pre">workflow_handoffs.zip</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</section>

        